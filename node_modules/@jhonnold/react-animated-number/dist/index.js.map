{"version":3,"file":"index.js","sources":["../src/index.tsx"],"sourcesContent":["import React from 'react';\nimport raf from 'raf';\n\ninterface FormatFn {\n    (value: number): string | number;\n}\n\ninterface Props extends React.HTMLAttributes<HTMLElement> {\n    number: number;\n    initial?: number;\n    fps?: number;\n    duration?: number;\n    format?: FormatFn;\n    component?: string;\n}\n\nconst AnimatedNumber: React.FC<Props> = (props: Props): React.ReactElement => {\n    const {\n        number,\n        initial = 0,\n        fps = 60,\n        duration = 250,\n        format,\n        component: C = 'p',\n        ...rest\n    } = props;\n\n    const [value, setValue] = React.useState<number>(initial);\n    const previousValue = React.useRef<number>(initial);\n\n    const lastTimestamp = React.useRef<number>(0);\n    const startTimestamp = React.useRef<number>(0);\n\n    const handle = React.useRef<number>();\n\n    const shouldProcess = (timestamp: number): boolean =>\n        !lastTimestamp.current ||\n        timestamp - lastTimestamp.current > 1000 / fps;\n\n    const animate = (timestamp: number, reset?: boolean): void => {\n        if (!shouldProcess(timestamp)) {\n            handle.current = raf(animate);\n            return;\n        }\n\n        const pValue = reset ? value : previousValue.current;\n        const sTimestamp = reset ? timestamp : startTimestamp.current;\n\n        let nextValue: number;\n        if (timestamp - sTimestamp >= duration) {\n            nextValue = number; // We are at time, just finish\n        } else {\n            const gap = number - pValue;\n            const pctDuration = (timestamp - sTimestamp) / duration;\n\n            nextValue = pValue + gap * pctDuration;\n        }\n\n        if (nextValue === number) {\n            endAnimation();\n            setValue(nextValue);\n        } else {\n            setValue(nextValue);\n            previousValue.current = pValue;\n\n            startTimestamp.current = sTimestamp;\n            lastTimestamp.current = timestamp;\n\n            handle.current = raf(animate);\n        }\n    };\n\n    const startAnimation = (): void => {\n        handle.current = raf(timestamp => {\n            animate(timestamp, true);\n        });\n    };\n\n    const endAnimation = (): void => {\n        if (handle.current) raf.cancel(handle.current);\n    };\n\n    React.useEffect(() => {\n        startAnimation();\n\n        return () => endAnimation();\n    }, []);\n\n    React.useEffect(() => {\n        endAnimation();\n        startAnimation();\n    }, [number]);\n\n    return <C {...rest}>{format ? format(value) : value}</C>;\n};\n\nexport default AnimatedNumber;\n"],"names":["AnimatedNumber","props","number","initial","fps","duration","format","component","C","rest","React","useState","value","setValue","previousValue","useRef","lastTimestamp","startTimestamp","handle","shouldProcess","timestamp","current","animate","reset","raf","pValue","sTimestamp","nextValue","gap","pctDuration","endAnimation","startAnimation","cancel","useEffect"],"mappings":"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"}